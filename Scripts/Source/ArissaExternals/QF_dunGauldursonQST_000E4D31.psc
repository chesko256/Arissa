;BEGIN FRAGMENT CODE - Do not edit anything between this and the end comment
;NEXT FRAGMENT INDEX 42
Scriptname QF_dunGauldursonQST_000E4D31 Extends Quest Hidden

;BEGIN ALIAS PROPERTY QT_JyrikInSaarthal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_JyrikInSaarthal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MikrulCombat
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MikrulCombat Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SecretDoor
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SecretDoor Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_GeirmundFragment
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_GeirmundFragment Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SigdisDuplicate03
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SigdisDuplicate03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY GauldursonEnablerFinal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_GauldursonEnablerFinal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_BookGeirmundsHall
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_BookGeirmundsHall Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SealedDoor2
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SealedDoor2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SummonActivator
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SummonActivator Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SigdisFinal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SigdisFinal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MikrulFinal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MikrulFinal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY JyrikFinal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_JyrikFinal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SigdisDuplicate02
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SigdisDuplicate02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_FolgunthurFragment
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_FolgunthurFragment Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Gauldur
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_Gauldur Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Map_Geirmunds
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_Map_Geirmunds Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_DaynasJournal02
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_DaynasJournal02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SarcophagusLid
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SarcophagusLid Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DragonClawIvory
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_DragonClawIvory Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SealedDoor3
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SealedDoor3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_GauldurAltar
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_GauldurAltar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY JyrikCombat
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_JyrikCombat Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MikrulAlly03
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MikrulAlly03 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_BookFolgunthur
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_BookFolgunthur Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SigdisCombat
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SigdisCombat Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ExitPortcullis
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_ExitPortcullis Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Map_Folgunthur
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_Map_Folgunthur Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY BanishActivator
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_BanishActivator Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SigdisDuplicate01
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SigdisDuplicate01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DaynasValenInFolgunthur
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_DaynasValenInFolgunthur Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_SigdisInGeirmunds
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_SigdisInGeirmunds Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Map_Reachwater
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_Map_Reachwater Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_MikrulInFolgunthur
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_MikrulInFolgunthur Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_SaarthalWrit
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_SaarthalWrit Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ReachwaterRockAdventurer
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_ReachwaterRockAdventurer Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_DaynasJournal01
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_DaynasJournal01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SealedDoor1
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_SealedDoor1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_ReachwaterRockEdict
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_ReachwaterRockEdict Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_FolgunthurWrit
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_FolgunthurWrit Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MikrulAlly02
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MikrulAlly02 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_GauldurAmulet
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_GauldurAmulet Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY InvisibleWall
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_InvisibleWall Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MusicActivator2
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MusicActivator2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY GeirmundsHallAdventurer
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_GeirmundsHallAdventurer Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY DragonClawEmerald
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_DragonClawEmerald Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_GeirmundWrit
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_GeirmundWrit Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MusicActivator
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MusicActivator Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_SaarthalFragment
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_SaarthalFragment Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Map_Saarthal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_Map_Saarthal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MikrulAlly01
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_MikrulAlly01 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_BookSaarthal
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_BookSaarthal Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY QT_BookReachwaterRock
;ALIAS PROPERTY TYPE referencealias
referencealias Property Alias_QT_BookReachwaterRock Auto
;END ALIAS PROPERTY

;BEGIN FRAGMENT Fragment_37
Function Fragment_37()
;BEGIN CODE
;Acquiring Daynas' journal in Folgunthur.
if (GetStageDone(20) && !GetStageDone(30) && GetStage() < 105)
   SetObjectiveCompleted(6)
   SetObjectiveCompleted(10)
   SetObjectiveCompleted(20)
   SetObjectiveDisplayed(21)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_2
Function Fragment_2()
;BEGIN CODE
;Player places the Folgunthur amulet fragment.
if (GetStageDone(101) && GetStageDone(102) && GetStageDone(103))
   SetStage(105)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_5
Function Fragment_5()
;BEGIN CODE
;Gauldursons Appear
Alias_ExitPortcullis.GetReference().Activate(Alias_Gauldur.GetReference())
Utility.Wait(0.5)
Alias_GauldursonEnablerFinal.GetReference().Activate(Game.GetPlayer())
Game.GetPlayer().RampRumble(0.75, 4, 1600)
RumbleSFX.Play(Game.GetPlayer())
Utility.Wait(1)
Alias_MusicActivator.GetReference().Activate(Game.GetPlayer())
Utility.Wait(3)
SetStage(110)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_40
Function Fragment_40()
;BEGIN CODE
;Player finds the amulet fragment in Saarthal without any prior context.
if (!GetStageDone(10) && !GetStageDone(30) && !GetStageDone(105))
     SetObjectiveDisplayed(6)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_29
Function Fragment_29()
;BEGIN CODE
if (GetStageDone(30))
   SetObjectiveCompleted(10)
   SetObjectiveCompleted(20)
   SetObjectiveCompleted(21)
   SetObjectiveCompleted(30)
   SetObjectiveDisplayed(100)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_39
Function Fragment_39()
;BEGIN CODE
;Player finds the amulet fragment in Geirmund's Hall without any prior context.
if (!GetStageDone(10) && !GetStageDone(30) && !GetStageDone(105))
     SetObjectiveDisplayed(6)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_17
Function Fragment_17()
;BEGIN CODE
Scene_JyrikStepForward.Stop()
Alias_JyrikCombat.OnGetUp(None)
(Alias_JyrikCombat as dunReachwaterRockJyrikBossBattle).BeginJyrikBattle()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_9
Function Fragment_9()
;BEGIN CODE
;Begin Jyrik battle.
Scene_JyrikStepForward.Start()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_15
Function Fragment_15()
;BEGIN CODE
Utility.Wait(3)
SetStage(130)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_21
Function Fragment_21()
;BEGIN CODE
;Grand Finale scene ends.
Alias_ExitPortcullis.GetReference().Activate(Alias_Gauldur.GetReference())
Alias_SecretDoor.GetReference().Activate(Alias_Gauldur.GetReference())
Alias_InvisibleWall.GetReference().Disable()
ReachwaterRockLocation.SetCleared(True)

if (GetStageDone(30))
     SetObjectiveDisplayed(150)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_35
Function Fragment_35()
;BEGIN CODE
;Player finds the fragment in Saarthal.
SetObjectiveCompleted(33)
if (GetStageDone(30) && GetStageDone(31) && GetStageDone(32) && GetStageDone(33))
     SetStage(100)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_0
Function Fragment_0()
;BEGIN CODE
;Testing stage for Reachwater Rock
Game.GetPlayer().AddItem(AmuletFragmentFolgunthur)
Game.GetPlayer().AddItem(AmuletFragmentGeirmund)
Game.GetPlayer().AddItem(AmuletFragmentSaarthal)
Game.GetPlayer().AddItem(IvoryDragonClaw)
Game.GetPlayer().AddItem(EmeraldDragonClaw)

(Alias_MikrulFinal as dunReachwaterRockGhostScript).Reload()
(Alias_SigdisFinal as dunReachwaterRockGhostScript).Reload()
(Alias_JyrikFinal as dunReachwaterRockGhostScript).Reload()
(Alias_Gauldur as dunReachwaterRockGhostScript).Reload()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_7
Function Fragment_7()
;BEGIN CODE
;Begin Mikrul battle.
Scene_MikrulStepForward.Start()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_32
Function Fragment_32()
;BEGIN CODE
;Reading Daynas' journal inside Folgunthur.
SetObjectiveCompleted(6)
SetObjectiveCompleted(10)
SetObjectiveCompleted(20)
SetObjectiveCompleted(21)

if (GetStage() < 105)
   if (GetStageDone(31) == 0)
      SetObjectiveDisplayed(31)
   Else
      SetObjectiveDisplayed(31)
      SetObjectiveCompleted(31)
   EndIf

   if (GetStageDone(32) == 0)
      SetObjectiveDisplayed(32)
   Else
      SetObjectiveDisplayed(32)
      SetObjectiveCompleted(32)
   EndIf

   if (GetStageDone(33) == 0)
      SetObjectiveDisplayed(33)
   Else
      SetObjectiveDisplayed(33)
      SetObjectiveCompleted(33)
   EndIf
   if (GetStageDone(30) && GetStageDone(31) && GetStageDone(32) && GetStageDone(33))
        SetObjectiveDisplayed(100)
   EndIf

   ;Add map markers.
   Alias_Map_Folgunthur.GetReference().AddToMap()
   Alias_Map_Geirmunds.GetReference().AddToMap()
   Alias_Map_Saarthal.GetReference().AddToMap()
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_16
Function Fragment_16()
;BEGIN CODE
Utility.Wait(3)
SetStage(140)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_38
Function Fragment_38()
;BEGIN CODE
;Player finds the amulet fragment in Folgunthur without any prior context.
if (!GetStageDone(10) && !GetStageDone(30) && !GetStageDone(105))
     SetObjectiveDisplayed(6)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_41
Function Fragment_41()
;BEGIN CODE
;Player reads the Edict in Reachwater Rock.
if (!GetStageDone(10) && !GetStageDone(30) && !GetStageDone(105))
     SetObjectiveDisplayed(6)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_18
Function Fragment_18()
;BEGIN CODE
;Player takes the Gauldur Amulet
(PedestalManager as dunReachwaterRockPedestalManager).DisableBeams()
SetObjectiveCompleted(150)
CompleteAllObjectives()
CompleteQuest()
(AchievementsQuest as AchievementsScript).IncSideQuests()
Stop()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_4
Function Fragment_4()
;BEGIN CODE
;Player places the Saarthal amulet fragment.
if (GetStageDone(101) && GetStageDone(102) && GetStageDone(103))
   SetStage(105)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_31
Function Fragment_31()
;BEGIN CODE
;Reading Daynas' journal outside Folgunthur.
if ((IsObjectiveDisplayed(6) || IsObjectiveDisplayed(10)) && GetStage() < 105 && !GetStageDone(30))
   SetObjectiveCompleted(6)
   SetObjectiveCompleted(10)
   if (Game.GetPlayer().GetItemCount(Alias_QT_DaynasJournal02.GetReference()) > 0)
      SetStage(21)
      SetObjectiveCompleted(20)
      SetObjectiveDisplayed(21)
   Else
      SetObjectiveDisplayed(20)
   EndIf
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_10
Function Fragment_10()
;BEGIN CODE
Scene_SigdisStepForward.Stop()
Alias_SigdisCombat.OnGetUp(None)
(Alias_SigdisCombat as dunReachwaterRockSigdisBossBattle).BeginSigdisBattle()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_3
Function Fragment_3()
;BEGIN CODE
;Player places the Geirmund amulet fragment.
if (GetStageDone(101) && GetStageDone(102) && GetStageDone(103))
   SetStage(105)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_6
Function Fragment_6()
;BEGIN CODE
;Begin the Grand Finale
;Alias_MikrulFinal.GetActorRef().SetNoBleedoutRecovery(False)
;Alias_SigdisFinal.GetActorRef().SetNoBleedoutRecovery(False)
;Alias_JyrikFinal.GetActorRef().SetNoBleedoutRecovery(False)
GrandFinale.Start()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_33
Function Fragment_33()
;BEGIN CODE
;Player finds the fragment in Folgunthur.
SetObjectiveCompleted(31)
if (GetStageDone(30) && GetStageDone(31) && GetStageDone(32) && GetStageDone(33))
     SetStage(100)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_34
Function Fragment_34()
;BEGIN CODE
;Player finds the fragment in Geirmund's.
SetObjectiveCompleted(32)
if (GetStageDone(30) && GetStageDone(31) && GetStageDone(32) && GetStageDone(33))
     SetStage(100)
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_1
Function Fragment_1()
;BEGIN CODE
;Quest can be started via Change Location event or reading the book.

;TEMP for testing Reachwater Rock (Gauldur's Tomb)
;SetStage(1)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_23
Function Fragment_23()
;BEGIN CODE
;Quest start from reading the 'Lost Legends' book.
if (!GetStageDone(20) && !GetStageDone(30) && GetStage() < 105)
   Alias_Map_Folgunthur.GetReference().AddToMap()
   SetObjectiveCompleted(6)

   ;If player hasn't read Daynas' Notes, figure out where to start the objective chain.
   if (!GetStageDone(20))
      SetObjectiveDisplayed(10)
   ElseIf (!GetStageDone(21))
      SetObjectiveDisplayed(20)
   Else
      SetObjectiveDisplayed(21)
   EndIf
EndIf
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_13
Function Fragment_13()
;BEGIN CODE
Scene_MikrulStepForward.Stop()
Alias_MikrulCombat.OnGetUp(None)
(Alias_MikrulCombat as dunReachwaterRockMikrulBossBattle).BeginMikrulBattle()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_14
Function Fragment_14()
;BEGIN CODE
Utility.Wait(3)
SetStage(120)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_8
Function Fragment_8()
;BEGIN CODE
;Begin Sigdis battle.
Scene_SigdisStepForward.Start()
;END CODE
EndFunction
;END FRAGMENT

;END FRAGMENT CODE - Do not edit anything between this and the begin comment

Armor Property AmuletFragmentFolgunthur  Auto  

Armor Property AmuletFragmentGeirmund  Auto  

Armor Property AmuletFragmentSaarthal  Auto  

Scene Property GrandFinale  Auto  

Scene Property Scene_SigdisStepForward  Auto  

Scene Property Scene_MikrulStepForward  Auto  

Scene Property JyrikStepForward  Auto  

Scene Property Scene_JyrikStepForward  Auto  

ObjectReference Property PedestalManager  Auto  

MiscObject Property IvoryDragonClaw  Auto  

MiscObject Property EmeraldDragonClaw  Auto  

Quest Property AchievementsQuest  Auto  

Location Property ReachwaterRockLocation  Auto  

Sound Property RumbleSFX  Auto  
