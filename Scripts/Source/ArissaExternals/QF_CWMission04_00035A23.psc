;BEGIN FRAGMENT CODE - Do not edit anything between this and the end comment
;NEXT FRAGMENT INDEX 22
Scriptname QF_CWMission04_00035A23 Extends Quest Hidden

;BEGIN ALIAS PROPERTY FieldCO
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FieldCO Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Friendly1
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Friendly1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier28
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier28 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier26
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier26 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier23
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier23 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier27
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier27 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerDoor4
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerDoor4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier29
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier29 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_AttackMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Chest
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Chest Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerDoor1
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerDoor1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier22
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier22 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerDoor2
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerDoor2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier21
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier21 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier24
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier24 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY SecretEntrance
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_SecretEntrance Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY CampaignStartMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_CampaignStartMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Friendly3
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Friendly3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Hold
;ALIAS PROPERTY TYPE locationalias
locationalias Property Alias_Hold Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier20
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier20 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerDoor3
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerDoor3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Friendly2
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Friendly2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackPointReservationMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_AttackPointReservationMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendlyStartMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendlyStartMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier25
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier25 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Player
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Player Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier5
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier5 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Prisoner3
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Prisoner3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Friend
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Friend Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier36
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier36 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier16
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier16 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier13
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier13 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier33
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier33 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Gatekeeper
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Gatekeeper Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MapMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_MapMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY MissionNumberRef
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_MissionNumberRef Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackPointEdgeMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_AttackPointEdgeMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerMarker1
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerMarker1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Prisoner2
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Prisoner2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackPoint
;ALIAS PROPERTY TYPE locationalias
locationalias Property Alias_AttackPoint Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerMarker4
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerMarker4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier32
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier32 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier8
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier8 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY AttackPointCenterMarker
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_AttackPointCenterMarker Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendlyStartMarkerSons
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendlyStartMarkerSons Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Prisoner4
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Prisoner4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier2
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier38
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier38 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier1
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier11
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier11 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY ExteriorPatroller
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_ExteriorPatroller Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier31
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier31 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier4
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier4 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier6
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier6 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier34
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier34 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendRalof
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendRalof Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier14
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier14 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier7
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier7 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier19
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier19 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerMarker2
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerMarker2 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Prisoner1
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Prisoner1 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier30
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier30 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier17
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier17 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Jailor
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Jailor Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendHadvar
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendHadvar Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier10
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier10 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier12
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier12 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY FriendlyStartMarkerImperial
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_FriendlyStartMarkerImperial Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier3
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY PrisonerMarker3
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_PrisonerMarker3 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier18
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier18 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier9
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier9 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier40
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier40 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier37
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier37 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier15
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier15 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier39
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier39 Auto
;END ALIAS PROPERTY

;BEGIN ALIAS PROPERTY Soldier35
;ALIAS PROPERTY TYPE referenceAlias
referenceAlias Property Alias_Soldier35 Auto
;END ALIAS PROPERTY

;BEGIN FRAGMENT Fragment_2
Function Fragment_2()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
; ; debug.traceConditional("CWMission04 Stage 0: Quest Started in " + Alias_AttackPoint.GetLocation(), kmyquest.CWs.debugon.value)
;debug.messageBox("CWMission04 Started")

kmyquest.FlagFieldCOWithPotentialMissionFactions(4) ;4 = Rescue Prisoner (this quest type)

kmyquest.ResetCommonMissionProperties()
;kmyquest.PrisonerFreed = 0

; ; debug.traceConditional("CWMission04 stage 0: creating Prisoner and forcing Gatekeeper, ExteriorPatroller, and Jailor aliases", kmyquest.CWs.debugon.value)
;Create the prisoner
;kmyquest.CreateAliasedPrisonerAlly(Alias_Prisoner1, Alias_PrisonerMarker1.getReference(), true, aiLevelMod = 4)
;kmyquest.CreateAliasedPrisonerAlly(Alias_Prisoner2, Alias_PrisonerMarker2.getReference(), true, aiLevelMod = 4)
;kmyquest.CreateAliasedPrisonerAlly(Alias_Prisoner3, Alias_PrisonerMarker3.getReference(), true, aiLevelMod = 3)
;kmyquest.CreateAliasedPrisonerAlly(Alias_Prisoner4, Alias_PrisonerMarker4.getReference(), true, aiLevelMod = 3)

if kmyquest.CWs.PlayerAllegiance == 1 ;IMPERIAL
	Alias_Prisoner1.ForceRefTo( Alias_PrisonerMarker1.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerImperialA, aiLevelMod = 2))
	Alias_Prisoner2.ForceRefTo( Alias_PrisonerMarker2.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerImperialB, aiLevelMod = 2))
	Alias_Prisoner3.ForceRefTo( Alias_PrisonerMarker3.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerImperialC, aiLevelMod = 3))
	Alias_Prisoner4.ForceRefTo( Alias_PrisonerMarker4.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerImperialD, aiLevelMod = 3))

else ;STORMCLOAK
	Alias_Prisoner1.ForceRefTo( Alias_PrisonerMarker1.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerSonsA, aiLevelMod = 2))
	Alias_Prisoner2.ForceRefTo( Alias_PrisonerMarker2.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerSonsB, aiLevelMod = 2))
	Alias_Prisoner3.ForceRefTo( Alias_PrisonerMarker3.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerSonsC, aiLevelMod = 3))
	Alias_Prisoner4.ForceRefTo( Alias_PrisonerMarker4.getReference().PlaceActorAtMe(kmyquest.CWs.CWPrisonerSonsD, aiLevelMod = 3))



endif



;system assumes the soldiers are enemy soldiers since they are filled with non-disabled CWSoldier ref types
;check to see if they have the job keywords and fill the corresponding aliases appropriately
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier1, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier2, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier3, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier4, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier5, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier6, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier7, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier8, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier9, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier10, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier11, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier12, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier13, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier14, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier15, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier16, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier17, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier18, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier19, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier20, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier21, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier22, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier23, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier24, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier25, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier26, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier27, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier28, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier29, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier30, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier31, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier32, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier33, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier34, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier35, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier36, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier37, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier38, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier39, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)
kmyquest.ForceAliasIntoFortJobAlias(Alias_Soldier40, Alias_Gatekeeper, Alias_Jailor, Alias_ExteriorPatroller)

;LOCK THE PRISONER DOOR
Alias_PrisonerDoor1.GetReference().Lock(25)
Alias_PrisonerDoor2.GetReference().Lock(25)
Alias_PrisonerDoor3.GetReference().Lock(25)
Alias_PrisonerDoor4.GetReference().Lock(25)

; ; debug.traceConditional("CWMission04 stage 0: turning off complex WI interactions", kmyquest.CWs.debugon.value)
kmyquest.ToggleOffComplexWIInteractions(Alias_AttackPoint)
kmyquest.CWs.RegisterEventHappening(Alias_AttackPoint.GetLocation())

;DONT THINK I NEED TO DO THIS ANYMORE
;RegisterForUpdate(5)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_17
Function Fragment_17()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
setObjectiveCompleted(40)
setObjectiveDisplayed(50)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_21
Function Fragment_21()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;player got close, friendlies should start walking to the rendevouz point
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_4
Function Fragment_4()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
; ; debug.traceConditional("CWMission04 stage 10", kmyquest.CWs.debugon.value)

kmyquest.FlagFieldCOWithActiveQuestFaction(MissionType = 4)

; ; debug.traceConditional("CWMission04 stage 10, moving Friend and enabling friendlies", kmyquest.CWs.debugon.value)
Alias_Friend.TryToMoveTo(Alias_FriendlyStartMarker.GetReference())
Alias_Friendly1.TryToMoveTo(Alias_FriendlyStartMarker.GetReference())
Alias_Friendly2.TryToMoveTo(Alias_FriendlyStartMarker.GetReference())
Alias_Friendly3.TryToMoveTo(Alias_FriendlyStartMarker.GetReference())

Alias_Friendly1.TryToEnable()
Alias_Friendly2.TryToEnable()
Alias_Friendly3.TryToEnable()

kmyquest.EnableMapMarkerAlias(Alias_MapMarker)
SetObjectiveDisplayed(10)

; ; debug.traceConditional("CWMission04 stage 10, resetting soldier aliases, enabling prisoner", kmyquest.CWs.debugon.value)

kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier1)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier2)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier3)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier4)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier5)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier6)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier7)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier8)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier9)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier10)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier11)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier12)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier13)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier14)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier15)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier16)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier17)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier18)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier19)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier20)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier21)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier22)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier23)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier24)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier25)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier26)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier27)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier28)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier29)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier30)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier31)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier32)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier33)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier34)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier35)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier36)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier37)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier38)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier39)
kmyquest.TryToResetEnemySoldierAlias(Alias_Soldier40)

;Enable created references in aliases
;*** TO DO: When we get arrays, CreateMissionAliasedActor() function could put actors in an array when creating them initally disabled, and then a new function could be written to enable all actors in that array)
Alias_Prisoner1.GetReference().Enable()
Alias_Prisoner2.GetReference().Enable()
Alias_Prisoner3.GetReference().Enable()
Alias_Prisoner4.GetReference().Enable()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_11
Function Fragment_11()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;shut down stage --  clean up created references, etc.
;NOTE: campaign should be advanced prior to this quest stage

; ; debug.traceConditional("CWMission04 stage 255 (shut down phase)", kmyquest.CWs.debugon.value)
kmyquest.ProcessFieldCOFactionsOnQuestShutDown()

Alias_Friend.GetActorReference().AddToFaction(kmyquest.CWs.CWBuddies)

Alias_PrisonerDoor1.UnregisterForUpdate()
Alias_Prisoner1.UnregisterForUpdate()

Alias_PrisonerDoor2.UnregisterForUpdate()
Alias_Prisoner2.UnregisterForUpdate()

Alias_PrisonerDoor3.UnregisterForUpdate()
Alias_Prisoner3.UnregisterForUpdate()

Alias_PrisonerDoor4.UnregisterForUpdate()
Alias_Prisoner4.UnregisterForUpdate()

UnregisterForUpdate()

; ; debug.traceConditional("CWMission04 stage 255: turning on complex WI interactions", kmyquest.CWs.debugon.value)
kmyquest.ToggleOnComplexWIInteractions(Alias_AttackPoint)
kmyquest.CWs.UnregisterEventHappening(Alias_AttackPoint.GetLocation())

;delete created references
;*** TO DO: When we have arrays, CreateMissionAliasedActor should put all created references to an array, then a new funciton should delete ALL of them
Alias_Prisoner1.GetReference().DeleteWhenAble()
Alias_Prisoner2.GetReference().DeleteWhenAble()
Alias_Prisoner3.GetReference().DeleteWhenAble()
Alias_Prisoner4.GetReference().DeleteWhenAble()
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_6
Function Fragment_6()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;FREED PRISONERS

; ; debug.traceConditional("CWMission04 stage 20", kmyquest.CWs.debugon.value)

kmyquest.moveFriendliesToAttackMarker()

SetObjectiveCompleted(10)
SetObjectiveCompleted(15)

SetObjectiveDisplayed(40)

;kmyquest.prisonerFreed = 1

;put prisoner in faction to make him hostile again prisonerRef
if Alias_Prisoner1.GetActorReference().IsInFaction(kmyquest.CWs.CWImperialFaction)
	Alias_Prisoner1.GetActorReference().AddToFaction(kmyquest.CWs.CWImperialFactionNPC)
else
	Alias_Prisoner1.GetActorReference().AddToFaction(kmyquest.CWs.CWSonsFactionNPC)
endif

;put prisoner in faction to make him hostile again prisonerRef
if Alias_Prisoner2.GetActorReference().IsInFaction(kmyquest.CWs.CWImperialFaction)
	Alias_Prisoner2.GetActorReference().AddToFaction(kmyquest.CWs.CWImperialFactionNPC)
else
	Alias_Prisoner2.GetActorReference().AddToFaction(kmyquest.CWs.CWSonsFactionNPC)
endif

;put prisoner in faction to make him hostile again prisonerRef
if Alias_Prisoner3.GetActorReference().IsInFaction(kmyquest.CWs.CWImperialFaction)
	Alias_Prisoner3.GetActorReference().AddToFaction(kmyquest.CWs.CWImperialFactionNPC)
else
	Alias_Prisoner3.GetActorReference().AddToFaction(kmyquest.CWs.CWSonsFactionNPC)
endif

;put prisoner in faction to make him hostile again prisonerRef
if Alias_Prisoner4.GetActorReference().IsInFaction(kmyquest.CWs.CWImperialFaction)
	Alias_Prisoner4.GetActorReference().AddToFaction(kmyquest.CWs.CWImperialFactionNPC)
else
	Alias_Prisoner4.GetActorReference().AddToFaction(kmyquest.CWs.CWSonsFactionNPC)
endif
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_9
Function Fragment_9()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;Successfully complete quest

; ; debug.traceConditional("CWMission04 stage 200 SUCCESS!!!", kmyquest.CWs.debugon.value)

kmyquest.FlagFieldCOWithMissionResultFaction(4)

kmyquest.CWs.CWMission04Done = 1 ;used to conditionalize story manager node

kmyquest.CWs.registerMissionSuccess(Alias_Hold.GetLocation(), isFortBattle = True)	;if isFortBattle then we won't display the Objective for the hold again, because we've just won the campain

kmyquest.CWs.WinHoldOffScreenIfNotDoingCapitalBattles(Alias_Hold.GetLocation())

;NOTE: quest stopped in CWMission04PrisonerScript to make sure he keeps his packages until he unloads
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_20
Function Fragment_20()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;All the prisoners died before you rescued them

kmyquest.moveFriendliesToAttackMarker()

SetObjectiveCompleted(10)
SetObjectiveFailed(15)

SetObjectiveDisplayed(40)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_13
Function Fragment_13()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;set in CWMission04PrisonerScript

setObjectiveCompleted(12)
setObjectiveDisplayed(15)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_16
Function Fragment_16()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;combat in the exterior started
;see combatStarted() in CWMission04Script and CWMission04SoldierScript

;in case you haven't gotten these yet

if IsObjectiveCompleted(12) == false
   SetObjectiveFailed(12)
endif

SetObjectiveDisplayed(15)
setObjectiveDisplayed(20)
setObjectiveDisplayed(40)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_10
Function Fragment_10()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
;Fail quest

; ; debug.traceConditional("CWMission04 stage 205 FAILURE!!!", kmyquest.CWs.debugon.value)

kmyquest.FlagFieldCOWithMissionResultFaction(4, MissionFailure = true)

UnregisterForUpdate()

stop()  ;if unsuccessful, stop quest... quest is also stopped in CWMission04PrisonerScript if successful and he unloads
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_15
Function Fragment_15()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
setObjectiveCompleted(10)
setObjectiveDisplayed(12)
;END CODE
EndFunction
;END FRAGMENT

;BEGIN FRAGMENT Fragment_8
Function Fragment_8()
;BEGIN AUTOCAST TYPE CWMission04Script
Quest __temp = self as Quest
CWMission04Script kmyQuest = __temp as CWMission04Script
;END AUTOCAST
;BEGIN CODE
kmyquest.objectiveCompleted = 1
;kmyquest.prisonerFreed = 2
setObjectiveCompleted(50)
;setObjectiveDisplayed(100)

;EITHER A) Report back to FieldCO
;setObjectiveDisplayed(100)

;OR B) immediate success
setStage(200)
;END CODE
EndFunction
;END FRAGMENT

;END FRAGMENT CODE - Do not edit anything between this and the begin comment
